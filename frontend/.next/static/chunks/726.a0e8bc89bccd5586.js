"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[726],{6726:function(e,s,t){t.r(s);var a=t(7437),n=t(2265),i=t(9843),l=t(2516);s.default=()=>{var e;let{user:s}=(0,l.a)(),[t,r]=(0,n.useState)([]),[o,c]=(0,n.useState)([]),[d,u]=(0,n.useState)(null),[m,h]=(0,n.useState)([]),[p,g]=(0,n.useState)(!1),[v,f]=(0,n.useState)(null);if(!s||!(null===(e=s.roles)||void 0===e?void 0:e.includes("admin")))return null;(0,n.useEffect)(()=>{let fetchRolesAndPermissions=async()=>{g(!0);try{let[e,s]=await Promise.all([i.ZP.get("/roles"),i.ZP.get("/permissions")]);r(e.data.roles||e.data),c(s.data.permissions||s.data)}catch(e){f("Failed to load roles or permissions")}finally{g(!1)}};fetchRolesAndPermissions()},[]);let handleRoleSelect=async e=>{u(e),g(!0);try{let s=await i.ZP.get("/roles/".concat(e.id,"/permissions"));h(s.data.permission_ids||s.data)}catch(e){h([])}finally{g(!1)}},handlePermissionToggle=e=>{h(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])},handleSave=async()=>{if(d){g(!0),f(null);try{await i.ZP.post("/roles/".concat(d.id,"/permissions"),{permissions:m}),alert("Permissions updated!")}catch(e){f("Failed to update permissions")}finally{g(!1)}}};return(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow p-6 mt-8",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Role & Permission Management"}),v&&(0,a.jsx)("div",{className:"text-red-500 mb-2",children:v}),(0,a.jsxs)("div",{className:"flex gap-8",children:[(0,a.jsxs)("div",{className:"w-1/3",children:[(0,a.jsx)("h3",{className:"font-semibold mb-2",children:"Roles"}),(0,a.jsx)("ul",{children:t.map(e=>(0,a.jsx)("li",{className:"cursor-pointer p-2 rounded mb-1 ".concat((null==d?void 0:d.id)===e.id?"bg-primary-100":""),onClick:()=>handleRoleSelect(e),children:e.name},e.id))})]}),(0,a.jsxs)("div",{className:"w-2/3",children:[(0,a.jsx)("h3",{className:"font-semibold mb-2",children:"Permissions"}),d?(0,a.jsxs)("div",{children:[(0,a.jsx)("ul",{className:"grid grid-cols-2 gap-2",children:o.map(e=>(0,a.jsx)("li",{children:(0,a.jsxs)("label",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",checked:m.includes(e.id),onChange:()=>handlePermissionToggle(e.id)}),e.name]})},e.id))}),(0,a.jsx)("button",{className:"btn-primary mt-4",onClick:handleSave,disabled:p,children:"Save Permissions"})]}):(0,a.jsx)("div",{className:"text-gray-500",children:"Select a role to manage permissions"})]})]})]})}},9843:function(e,s,t){t.d(s,{BG:function(){return i}});var a=t(4829);let n=a.Z.create({baseURL:"http://localhost/Envisage/backend/public/api",timeout:1e4,headers:{"Content-Type":"application/json"}});n.interceptors.request.use(e=>{{let s=localStorage.getItem("auth_token");s&&(e.headers.Authorization="Bearer ".concat(s))}return e},e=>Promise.reject(e)),n.interceptors.response.use(e=>e.data,e=>{var s,t;return(null===(s=e.response)||void 0===s?void 0:s.status)===401&&(localStorage.removeItem("auth_token"),localStorage.removeItem("user_data"),window.location.href="/auth/login"),Promise.reject((null===(t=e.response)||void 0===t?void 0:t.data)||e)});let i={getListings:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=new URLSearchParams;return Object.entries(e).forEach(e=>{let[t,a]=e;void 0!==a&&""!==a&&s.append(t,a.toString())}),n.get("/products?".concat(s.toString()))},getListing:async e=>n.get("/products/".concat(e)),createListing:async e=>n.post("/products",e),updateListing:async(e,s)=>n.put("/products/".concat(e),s),deleteListing:async e=>n.delete("/products/".concat(e)),getMyListings:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=new URLSearchParams;return Object.entries(e).forEach(e=>{let[t,a]=e;void 0!==a&&""!==a&&s.append(t,a.toString())}),n.get("/seller/products?".concat(s.toString()))},searchListings:async function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n.get("/products",{params:{search:e,...s}})},buyListing:async(e,s)=>{let t={...s,items:[{product_id:e,quantity:1}]};return n.post("/orders",t)}};s.ZP=n}}]);