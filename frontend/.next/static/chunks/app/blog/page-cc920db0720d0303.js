(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[404],{6285:function(e,t,o){Promise.resolve().then(o.bind(o,3432))},3432:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return BlogPage}});var s=o(7437),a=o(2265),r=o(2516);function BlogPage(){let{isAuthenticated:e}=(0,r.a)(),[t,o]=(0,a.useState)([]),[n,l]=(0,a.useState)(!0),[i,c]=(0,a.useState)(null);return((0,a.useEffect)(()=>{l(!0),fetch("/api/blog-posts").then(e=>e.json()).then(e=>{o(e||[]),c(null)}).catch(e=>{c(e.message||"Failed to load blog posts")}).finally(()=>l(!1))},[]),n)?(0,s.jsx)("div",{children:"Loading blog posts..."}):i?(0,s.jsx)("div",{className:"text-red-500",children:i}):(0,s.jsxs)("div",{className:"max-w-3xl mx-auto py-8",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Blog"}),0===t.length?(0,s.jsx)("div",{children:"No blog posts found."}):(0,s.jsx)("ul",{children:t.map(e=>{var t;return(0,s.jsxs)("li",{className:"mb-4",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold",children:e.title}),(0,s.jsxs)("p",{className:"text-gray-600",children:[null===(t=e.content)||void 0===t?void 0:t.slice(0,120),"..."]}),(0,s.jsxs)("div",{className:"text-xs text-gray-400",children:["By ",e.author_id," on ",e.published_at||e.created_at]})]},e.id)})})]})}},2516:function(e,t,o){"use strict";o.d(t,{a:function(){return useAuth}});var s=o(2265),a=o(4033),r=o(4829),n=o(5925);let l=r.Z.create({baseURL:"http://localhost/Envisage/backend/public/api",headers:{"Content-Type":"application/json",Accept:"application/json"}});let TokenStorage=class TokenStorage{static setToken(e,t){if(localStorage.setItem(this.TOKEN_KEY,e),t){let e=Date.now()+1e3*t;localStorage.setItem(this.EXPIRES_KEY,e.toString())}}static getToken(){let e=localStorage.getItem(this.TOKEN_KEY),t=localStorage.getItem(this.EXPIRES_KEY);return e&&t&&Date.now()>parseInt(t)?(this.removeToken(),null):e}static removeToken(){localStorage.removeItem(this.TOKEN_KEY),localStorage.removeItem(this.REFRESH_KEY),localStorage.removeItem(this.EXPIRES_KEY)}static isTokenExpired(){let e=localStorage.getItem(this.EXPIRES_KEY);return!!e&&Date.now()>parseInt(e)}};TokenStorage.TOKEN_KEY="envisage_auth_token",TokenStorage.REFRESH_KEY="envisage_refresh_token",TokenStorage.EXPIRES_KEY="envisage_token_expires",l.interceptors.request.use(e=>{let t=TokenStorage.getToken();return t&&(e.headers.Authorization="Bearer ".concat(t)),e}),l.interceptors.response.use(e=>e,e=>{var t;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(TokenStorage.removeToken(),window.location.href="/login"),Promise.reject(e)});let useAuth=()=>{let[e,t]=(0,s.useState)(null),[o,r]=(0,s.useState)(!0),i=(0,a.useRouter)(),c=!!e&&!!TokenStorage.getToken(),u=(0,s.useCallback)(async()=>{try{let e=TokenStorage.getToken();if(!e)return null;let o=await l.get("/user",{headers:{Authorization:"Bearer ".concat(e)}}),s=o.data;return t(s),s}catch(s){var e,o;return console.error("Failed to get user:",s),((null===(e=s.response)||void 0===e?void 0:e.status)===401||(null===(o=s.response)||void 0===o?void 0:o.status)===404)&&(TokenStorage.removeToken(),t(null)),null}},[]);(0,s.useEffect)(()=>{let initializeAuth=async()=>{let e=TokenStorage.getToken();if(e&&!TokenStorage.isTokenExpired())try{await u()}catch(e){console.error("Failed to initialize auth:",e),TokenStorage.removeToken()}r(!1)};initializeAuth()},[u]);let g=(0,s.useCallback)(async e=>{try{r(!0);let o=await l.post("/login",e),{access_token:s,user:a}=o.data;if(s)return TokenStorage.setToken(s),t(a),n.toast.success("Welcome back, ".concat(a.name,"!")),{success:!0,message:"Login successful",user:a};return n.toast.error("Login failed - no token received"),{success:!1,message:"Login failed"}}catch(t){var o,s;console.error("âŒ Login error:",t);let e=(null===(s=t.response)||void 0===s?void 0:null===(o=s.data)||void 0===o?void 0:o.message)||"Login failed. Please check your credentials.";return n.toast.error(e),{success:!1,message:e}}finally{r(!1)}},[]),d=(0,s.useCallback)(async e=>{try{r(!0);let o=await l.post("/register",e),{access_token:s,user:a}=o.data;if(s&&a)return TokenStorage.setToken(s),t(a),n.toast.success("Welcome to Envisage, ".concat(a.name,"!")),{success:!0,message:"Registration successful",user:a};return n.toast.error("Registration failed - no token received"),{success:!1,message:"Registration failed"}}catch(t){var o,s;console.error("Registration error:",t);let e=(null===(s=t.response)||void 0===s?void 0:null===(o=s.data)||void 0===o?void 0:o.message)||"Registration failed. Please try again.";return n.toast.error(e),{success:!1,message:e}}finally{r(!1)}},[]),h=(0,s.useCallback)(async()=>{try{let e=TokenStorage.getToken();await l.post("/logout",{},{headers:{Authorization:"Bearer ".concat(e)}})}catch(e){console.error("Logout request failed:",e)}finally{TokenStorage.removeToken(),t(null),n.toast.success("Logged out successfully"),i.push("/")}},[i]),k=(0,s.useCallback)(async()=>{try{let e=await l.post("/auth/refresh"),{status:o,data:s}=e.data;if("success"===o&&s)return TokenStorage.setToken(s.token,s.expires_in),t(s.user),!0;return!1}catch(e){return console.error("Token refresh failed:",e),TokenStorage.removeToken(),t(null),!1}},[]);return(0,s.useEffect)(()=>{if(!c)return;let e=setInterval(async()=>{let e=TokenStorage.getToken();if(e&&TokenStorage.isTokenExpired()){let e=await k();e||i.push("/login")}},3e5);return()=>clearInterval(e)},[c,k,i]),{user:e,isAuthenticated:c,isLoading:o,login:g,register:d,logout:h,getUser:u,refreshToken:k}}}},function(e){e.O(0,[424,971,472,744],function(){return e(e.s=6285)}),_N_E=e.O()}]);