(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[565],{4969:function(e,t,a){Promise.resolve().then(a.bind(a,1691))},1691:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return CartPage}});var r=a(7437),s=a(2265),n=a(2516),l=a(5925),c=a(4829),i=a(4182),o=a(3827);function LoadingSpinner(e){let{size:t="md",text:a,fullScreen:s=!1}=e,n=(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full border-b-2 border-primary-600 mx-auto ".concat({sm:"h-6 w-6",md:"h-12 w-12",lg:"h-16 w-16"}[t])}),a&&(0,r.jsx)("p",{className:"mt-4 text-gray-600",children:a})]});return s?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:n}):n}var d=a(7227),m=a(1396),x=a.n(m);let u="http://localhost/Envisage/backend/public/api";let TokenStorage=class TokenStorage{static getToken(){return localStorage.getItem(this.TOKEN_KEY)}};function CartContent(){let{user:e,isAuthenticated:t}=(0,n.a)(),[a,i]=(0,s.useState)(null),[m,h]=(0,s.useState)(!0),[p,g]=(0,s.useState)(null),fetchCart=async()=>{if(!t||!e){h(!1);return}try{h(!0),g(null);let e=TokenStorage.getToken();if(!e){g("Not authenticated. Please log in again."),h(!1);return}let t=await c.Z.get("".concat(u,"/cart"),{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json",Accept:"application/json"}});console.log("Cart response:",t.data),i(t.data)}catch(t){var a,r;console.error("Cart error:",t);let e=(null===(r=t.response)||void 0===r?void 0:null===(a=r.data)||void 0===a?void 0:a.message)||t.message||"Failed to load cart";g(e),l.toast.error(e)}finally{h(!1)}};(0,s.useEffect)(()=>{fetchCart()},[t,e]);let handleRemoveItem=async e=>{try{let t=TokenStorage.getToken();await c.Z.delete("".concat(u,"/cart/").concat(e),{headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}}),l.toast.success("Item removed from cart"),fetchCart()}catch(e){console.error("Remove item error:",e),l.toast.error("Failed to remove item")}},handleUpdateQuantity=async(e,t)=>{if(!(t<1))try{let a=TokenStorage.getToken();await c.Z.put("".concat(u,"/cart/").concat(e),{quantity:t},{headers:{Authorization:"Bearer ".concat(a),"Content-Type":"application/json"}}),fetchCart()}catch(e){var a,r;console.error("Update quantity error:",e),l.toast.error((null===(r=e.response)||void 0===r?void 0:null===(a=r.data)||void 0===a?void 0:a.error)||"Failed to update quantity")}};return m?(0,r.jsx)(LoadingSpinner,{size:"lg",text:"Loading your cart...",fullScreen:!0}):p?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.Z,{}),(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md",children:[(0,r.jsx)("p",{className:"text-red-600 mb-4",children:p}),(0,r.jsx)("button",{onClick:fetchCart,className:"btn-primary",children:"Try Again"})]})})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.Z,{}),(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-8",children:"Shopping Cart"}),a&&a.items&&0!==a.items.length?(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,r.jsx)("div",{className:"lg:col-span-2 space-y-4",children:a.items.map(e=>{var t,a;return(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:(0,r.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,r.jsx)("div",{className:"w-24 h-24 bg-gray-100 rounded-lg flex-shrink-0 overflow-hidden",children:(e.product.image||(null===(t=e.product.images)||void 0===t?void 0:t[0]))&&(0,r.jsx)("img",{src:e.product.image||(null===(a=e.product.images)||void 0===a?void 0:a[0]),alt:e.product.title,className:"w-full h-full object-cover"})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:e.product.title}),(0,r.jsxs)("p",{className:"text-xl font-bold text-primary-600 mb-3",children:["ZMW ",e.product.price.toFixed(2)]}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsxs)("div",{className:"flex items-center border border-gray-300 rounded-lg",children:[(0,r.jsx)("button",{onClick:()=>handleUpdateQuantity(e.id,e.quantity-1),className:"px-3 py-1 hover:bg-gray-100",disabled:e.quantity<=1,children:"-"}),(0,r.jsx)("span",{className:"px-4 py-1 border-x border-gray-300",children:e.quantity}),(0,r.jsx)("button",{onClick:()=>handleUpdateQuantity(e.id,e.quantity+1),className:"px-3 py-1 hover:bg-gray-100",disabled:e.quantity>=e.product.stock,children:"+"})]}),(0,r.jsxs)("button",{onClick:()=>handleRemoveItem(e.id),className:"text-red-600 hover:text-red-800 flex items-center space-x-1",children:[(0,r.jsx)(d.Z,{className:"h-5 w-5"}),(0,r.jsx)("span",{children:"Remove"})]})]}),e.product.stock<5&&(0,r.jsxs)("p",{className:"text-sm text-orange-600 mt-2",children:["Only ",e.product.stock," left in stock"]})]}),(0,r.jsx)("div",{className:"text-right",children:(0,r.jsxs)("p",{className:"text-lg font-semibold text-gray-900",children:["ZMW ",(e.product.price*e.quantity).toFixed(2)]})})]})},e.id)})}),(0,r.jsx)("div",{className:"lg:col-span-1",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6 sticky top-8",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Order Summary"}),(0,r.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,r.jsxs)("div",{className:"flex justify-between text-gray-600",children:[(0,r.jsxs)("span",{children:["Subtotal (",a.item_count," items)"]}),(0,r.jsxs)("span",{children:["ZMW ",a.total.toFixed(2)]})]}),(0,r.jsxs)("div",{className:"flex justify-between text-gray-600",children:[(0,r.jsx)("span",{children:"Shipping"}),(0,r.jsx)("span",{children:"Calculated at checkout"})]}),(0,r.jsx)("div",{className:"border-t border-gray-200 pt-3",children:(0,r.jsxs)("div",{className:"flex justify-between text-lg font-semibold text-gray-900",children:[(0,r.jsx)("span",{children:"Total"}),(0,r.jsxs)("span",{children:["ZMW ",a.total.toFixed(2)]})]})})]}),(0,r.jsx)(x(),{href:"/checkout",className:"btn-primary w-full block text-center mb-3",children:"Proceed to Checkout"}),(0,r.jsx)(x(),{href:"/marketplace",className:"btn-secondary w-full block text-center",children:"Continue Shopping"})]})})]}):(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-12 text-center",children:[(0,r.jsx)("p",{className:"text-gray-500 mb-4",children:"Your cart is empty"}),(0,r.jsx)(x(),{href:"/marketplace",className:"btn-primary inline-block",children:"Continue Shopping"})]})]})})]})}function CartPage(){return(0,r.jsx)(i.Z,{children:(0,r.jsx)(CartContent,{})})}TokenStorage.TOKEN_KEY="envisage_auth_token"},4182:function(e,t,a){"use strict";a.d(t,{Z:function(){return ProtectedRoute}});var r=a(7437),s=a(2265),n=a(4033),l=a(2516);function ProtectedRoute(e){let{children:t,redirectTo:a="/login",fallback:c,requiredRoles:i=[]}=e,{isAuthenticated:o,isLoading:d,user:m}=(0,l.a)(),x=(0,n.useRouter)();if((0,s.useEffect)(()=>{if(!d){if(!o){let e=window.location.pathname;x.push("".concat(a,"?redirect=").concat(encodeURIComponent(e)));return}if(i.length>0&&m){let e=m.roles||[],t=i.some(t=>e.includes(t));if(!t){x.push("/marketplace");return}}}},[o,d,m,x,a,i]),d)return c||(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),(0,r.jsx)("p",{className:"mt-4 text-gray-600",children:"Verifying access..."})]})});if(!o)return null;if(i.length>0&&m){let e=m.roles||[],t=i.some(t=>e.includes(t));if(!t)return(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsx)("div",{className:"text-center max-w-md mx-auto p-6",children:(0,r.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-yellow-800 mb-2",children:"Access Denied"}),(0,r.jsx)("p",{className:"text-yellow-700 mb-4",children:"You don't have permission to access this page."}),(0,r.jsx)("button",{onClick:()=>x.push("/marketplace"),className:"btn-primary px-6 py-2",children:"Go to Marketplace"})]})})})}return(0,r.jsx)(r.Fragment,{children:t})}},7227:function(e,t,a){"use strict";var r=a(2265);function TrashIcon({title:e,titleId:t,...a},s){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},a),e?r.createElement("title",{id:t},e):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"}))}let s=r.forwardRef(TrashIcon);t.Z=s}},function(e){e.O(0,[424,858,827,971,472,744],function(){return e(e.s=4969)}),_N_E=e.O()}]);