(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[311],{8899:function(e,t,s){Promise.resolve().then(s.bind(s,8359))},8359:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return ListingsPage}});var r=s(7437),a=s(2265),i=s(732);function PlusIcon({title:e,titleId:t,...s},r){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?a.createElement("title",{id:t},e):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))}let n=a.forwardRef(PlusIcon);var l=s(654),c=s(9367),d=s(2125),o=s(7227),x=s(2516),m=s(3827),u=s(4182),h=s(1396),p=s.n(h),g=s(5925),f=s(9843);function ListingsContent(){let{user:e}=(0,x.a)(),[t,s]=(0,a.useState)([]),[u,h]=(0,a.useState)(!0),[y,j]=(0,a.useState)(null),[v,w]=(0,a.useState)("all");(0,a.useEffect)(()=>{fetchListings()},[]);let fetchListings=async()=>{try{h(!0),j(null);let e=await f.BG.getMyListings();console.log("Listings API response:",e);let t=[];"success"===e.status&&e.data?t=Array.isArray(e.data)?e.data:[]:Array.isArray(e.data)?t=e.data:Array.isArray(e)&&(t=e),s(t),0===t.length&&console.log("No listings found for this seller")}catch(r){var e,t;console.error("Error fetching listings:",r);let s=(null===(t=r.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||r.message||"Failed to load listings";j(s),g.toast.error(s)}finally{h(!1)}},handleDelete=async e=>{if(confirm("Are you sure you want to delete this listing?"))try{await f.BG.deleteListing(e),s(t.filter(t=>t.id!==e)),g.toast.success("Listing deleted successfully")}catch(e){console.error("Error deleting listing:",e),g.toast.error("Failed to delete listing")}},getStatusBadge=e=>{switch(e){case"active":return(0,r.jsx)("span",{className:"px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium",children:"Active"});case"out_of_stock":return(0,r.jsx)("span",{className:"px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm font-medium",children:"Out of Stock"});case"draft":return(0,r.jsx)("span",{className:"px-3 py-1 bg-gray-100 text-gray-800 rounded-full text-sm font-medium",children:"Draft"});default:return null}},N=t.filter(e=>"all"===v||e.status===v),b=t.reduce((e,t)=>e+(t.sold||0)*t.price,0),k=t.reduce((e,t)=>e+(t.sold||0),0);return u?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(m.Z,{}),(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"}),(0,r.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading your listings..."})]})})})]}):y?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(m.Z,{}),(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("p",{className:"text-red-600 mb-4",children:y}),(0,r.jsx)("button",{onClick:fetchListings,className:"btn-primary",children:"Try Again"})]})})})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(m.Z,{}),(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,r.jsx)(i.E.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"My Listings"}),(0,r.jsx)("p",{className:"text-gray-600 mt-1",children:"Manage your products and inventory"})]}),(0,r.jsxs)(p(),{href:"/listings/create",className:"btn-primary px-6 py-3 flex items-center space-x-2",children:[(0,r.jsx)(n,{className:"h-5 w-5"}),(0,r.jsx)("span",{children:"Add New Product"})]})]})}),(0,r.jsxs)(i.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-md p-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Total Listings"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:t.length})]}),(0,r.jsx)("div",{className:"h-12 w-12 bg-primary-100 rounded-lg flex items-center justify-center",children:(0,r.jsx)(l.Z,{className:"h-6 w-6 text-primary-600"})})]})}),(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-md p-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Active Products"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-green-600 mt-1",children:t.filter(e=>"active"===e.status).length})]}),(0,r.jsx)("div",{className:"h-12 w-12 bg-green-100 rounded-lg flex items-center justify-center",children:(0,r.jsx)(c.Z,{className:"h-6 w-6 text-green-600"})})]})}),(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-md p-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Total Sold"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-blue-600 mt-1",children:k})]}),(0,r.jsx)("div",{className:"h-12 w-12 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,r.jsx)(l.Z,{className:"h-6 w-6 text-blue-600"})})]})}),(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-md p-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Revenue"}),(0,r.jsxs)("p",{className:"text-2xl font-bold text-purple-600 mt-1",children:["ZMW ",b.toFixed(2)]})]}),(0,r.jsx)("div",{className:"h-12 w-12 bg-purple-100 rounded-lg flex items-center justify-center",children:(0,r.jsx)(l.Z,{className:"h-6 w-6 text-purple-600"})})]})})]}),(0,r.jsx)(i.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white rounded-lg shadow-md p-4 mb-6",children:(0,r.jsx)("div",{className:"flex space-x-2",children:["all","active","out_of_stock","draft"].map(e=>(0,r.jsx)("button",{onClick:()=>w(e),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat(v===e?"bg-primary-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"all"===e?"All":e.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")},e))})}),(0,r.jsxs)(i.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-white rounded-lg shadow-md overflow-hidden",children:[(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full",children:[(0,r.jsx)("thead",{className:"bg-gray-50 border-b border-gray-200",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Price"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Stock"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Sold"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Views"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,r.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,r.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:N.map(e=>{var t,s;return(0,r.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"h-10 w-10 bg-gray-100 rounded flex-shrink-0 mr-3 overflow-hidden",children:e.image||(null===(t=e.images)||void 0===t?void 0:t[0])?(0,r.jsx)("img",{src:e.image||(null===(s=e.images)||void 0===s?void 0:s[0]),alt:e.title,className:"h-full w-full object-cover"}):null}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.title}),(0,r.jsxs)("div",{className:"text-sm text-gray-500",children:["ID: ",e.id]})]})]})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{className:"text-sm font-semibold text-gray-900",children:["ZMW ",e.price.toFixed(2)]})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("div",{className:"text-sm font-medium ".concat(0===e.stock?"text-red-600":"text-gray-900"),children:e.stock})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("div",{className:"text-sm text-gray-900",children:e.sold||0})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("div",{className:"text-sm text-gray-900",children:e.views||0})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:getStatusBadge(e.status)}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,r.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,r.jsx)(p(),{href:"/products/".concat(e.id),className:"text-blue-600 hover:text-blue-900",title:"View",children:(0,r.jsx)(c.Z,{className:"h-5 w-5"})}),(0,r.jsx)(p(),{href:"/listings/".concat(e.id,"/edit"),className:"text-primary-600 hover:text-primary-900",title:"Edit",children:(0,r.jsx)(d.Z,{className:"h-5 w-5"})}),(0,r.jsx)("button",{onClick:()=>handleDelete(e.id),className:"text-red-600 hover:text-red-900",title:"Delete",children:(0,r.jsx)(o.Z,{className:"h-5 w-5"})})]})})]},e.id)})})]})}),0===N.length&&!u&&(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("p",{className:"text-gray-500 mb-4",children:"all"===v?"No listings found. Start by creating your first product!":"No ".concat(v.split("_").join(" ")," listings found")}),"all"===v&&(0,r.jsxs)(p(),{href:"/sell",className:"btn-primary inline-block",children:[(0,r.jsx)(n,{className:"h-5 w-5 inline mr-2"}),"Create Your First Listing"]})]})]})]})})]})}function ListingsPage(){return(0,r.jsx)(u.Z,{requiredRoles:["admin","seller"],children:(0,r.jsx)(ListingsContent,{})})}},4182:function(e,t,s){"use strict";s.d(t,{Z:function(){return ProtectedRoute}});var r=s(7437),a=s(2265),i=s(4033),n=s(2516);function ProtectedRoute(e){let{children:t,redirectTo:s="/login",fallback:l,requiredRoles:c=[]}=e,{isAuthenticated:d,isLoading:o,user:x}=(0,n.a)(),m=(0,i.useRouter)();if((0,a.useEffect)(()=>{if(!o){if(!d){let e=window.location.pathname;m.push("".concat(s,"?redirect=").concat(encodeURIComponent(e)));return}if(c.length>0&&x){let e=x.roles||[],t=c.some(t=>e.includes(t));if(!t){m.push("/marketplace");return}}}},[d,o,x,m,s,c]),o)return l||(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),(0,r.jsx)("p",{className:"mt-4 text-gray-600",children:"Verifying access..."})]})});if(!d)return null;if(c.length>0&&x){let e=x.roles||[],t=c.some(t=>e.includes(t));if(!t)return(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsx)("div",{className:"text-center max-w-md mx-auto p-6",children:(0,r.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-yellow-800 mb-2",children:"Access Denied"}),(0,r.jsx)("p",{className:"text-yellow-700 mb-4",children:"You don't have permission to access this page."}),(0,r.jsx)("button",{onClick:()=>m.push("/marketplace"),className:"btn-primary px-6 py-2",children:"Go to Marketplace"})]})})})}return(0,r.jsx)(r.Fragment,{children:t})}},9843:function(e,t,s){"use strict";s.d(t,{BG:function(){return i}});var r=s(4829);let a=r.Z.create({baseURL:"http://localhost/Envisage/backend/public/api",timeout:1e4,headers:{"Content-Type":"application/json"}});a.interceptors.request.use(e=>{{let t=localStorage.getItem("auth_token");t&&(e.headers.Authorization="Bearer ".concat(t))}return e},e=>Promise.reject(e)),a.interceptors.response.use(e=>e.data,e=>{var t,s;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(localStorage.removeItem("auth_token"),localStorage.removeItem("user_data"),window.location.href="/auth/login"),Promise.reject((null===(s=e.response)||void 0===s?void 0:s.data)||e)});let i={getListings:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams;return Object.entries(e).forEach(e=>{let[s,r]=e;void 0!==r&&""!==r&&t.append(s,r.toString())}),a.get("/products?".concat(t.toString()))},getListing:async e=>a.get("/products/".concat(e)),createListing:async e=>a.post("/products",e),updateListing:async(e,t)=>a.put("/products/".concat(e),t),deleteListing:async e=>a.delete("/products/".concat(e)),getMyListings:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams;return Object.entries(e).forEach(e=>{let[s,r]=e;void 0!==r&&""!==r&&t.append(s,r.toString())}),a.get("/seller/products?".concat(t.toString()))},searchListings:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return a.get("/products",{params:{search:e,...t}})},buyListing:async(e,t)=>{let s={...t,items:[{product_id:e,quantity:1}]};return a.post("/orders",s)}};t.ZP=a},654:function(e,t,s){"use strict";var r=s(2265);function ChartBarIcon({title:e,titleId:t,...s},a){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},s),e?r.createElement("title",{id:t},e):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z"}))}let a=r.forwardRef(ChartBarIcon);t.Z=a},9367:function(e,t,s){"use strict";var r=s(2265);function EyeIcon({title:e,titleId:t,...s},a){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},s),e?r.createElement("title",{id:t},e):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"}),r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}))}let a=r.forwardRef(EyeIcon);t.Z=a},2125:function(e,t,s){"use strict";var r=s(2265);function PencilIcon({title:e,titleId:t,...s},a){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},s),e?r.createElement("title",{id:t},e):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125"}))}let a=r.forwardRef(PencilIcon);t.Z=a},7227:function(e,t,s){"use strict";var r=s(2265);function TrashIcon({title:e,titleId:t,...s},a){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},s),e?r.createElement("title",{id:t},e):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"}))}let a=r.forwardRef(TrashIcon);t.Z=a}},function(e){e.O(0,[424,858,732,827,971,472,744],function(){return e(e.s=8899)}),_N_E=e.O()}]);