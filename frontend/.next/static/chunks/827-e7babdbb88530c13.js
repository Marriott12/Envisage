"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[827],{3827:function(e,t,r){r.d(t,{Z:function(){return Header}});var s=r(7437),a=r(2265),o=r(1396),l=r.n(o),n=r(4033),i=r(6691),c=r.n(i),d=r(4020),g=r(2170),u=r(1809),h=r(4164),m=r(6689),x=r(9874),p=r(2516),y=r(4962);function Header(){let[e,t]=(0,a.useState)(!1),[r,o]=(0,a.useState)(""),[i,f]=(0,a.useState)(!1),v=(0,a.useRef)(null),k=(0,n.useRouter)(),{user:b,isAuthenticated:j,logout:N,isLoading:S}=(0,p.a)(),{items:T}=(0,y.xS)();(0,a.useEffect)(()=>{function handleClickOutside(e){v.current&&!v.current.contains(e.target)&&f(!1)}if(i)return document.addEventListener("mousedown",handleClickOutside),()=>{document.removeEventListener("mousedown",handleClickOutside)}},[i]);let handleSearch=e=>{e.preventDefault(),r.trim()&&k.push("/marketplace?search=".concat(encodeURIComponent(r.trim())))},handleLogout=async()=>{await N(),f(!1),k.push("/")},w=T.reduce((e,t)=>e+t.quantity,0),E=(null==b?void 0:b.role)||"customer",C=E.charAt(0).toUpperCase()+E.slice(1);return(0,s.jsx)("header",{className:"bg-white border-b border-gray-200 sticky top-0 z-50",children:(0,s.jsxs)("div",{className:"container mx-auto px-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between h-16",children:[(0,s.jsx)(l(),{href:"/",className:"flex items-center space-x-2",children:(0,s.jsx)(c(),{src:"/logo.png",alt:"Envisage Technology Zambia",width:150,height:40,style:{width:"auto",height:"40px"},priority:!0})}),(0,s.jsx)("div",{className:"hidden md:flex flex-1 max-w-2xl mx-8",children:(0,s.jsx)("form",{onSubmit:handleSearch,className:"w-full",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:"text",value:r,onChange:e=>o(e.target.value),placeholder:"Search for items...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"}),(0,s.jsx)(d.Z,{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400"})]})})}),(0,s.jsxs)("div",{className:"hidden md:flex items-center space-x-4",children:[(0,s.jsx)(l(),{href:"/marketplace",className:"text-gray-700 hover:text-gray-900 px-3 py-2 rounded-lg hover:bg-gray-100 transition-colors",children:"Browse"}),(0,s.jsx)(l(),{href:"/sell",className:"text-gray-700 hover:text-gray-900 px-3 py-2 rounded-lg hover:bg-gray-100 transition-colors",children:"Sell"}),(0,s.jsxs)(l(),{href:"/cart",className:"relative p-2 text-gray-700 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",children:[(0,s.jsx)(g.Z,{className:"h-6 w-6"}),w>0&&(0,s.jsx)("span",{className:"absolute -top-1 -right-1 bg-primary-600 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:w})]}),j?(0,s.jsxs)("div",{className:"relative",ref:v,children:[(0,s.jsxs)("button",{onClick:()=>f(!i),className:"flex items-center space-x-2 text-gray-700 hover:text-gray-900 px-3 py-2 rounded-lg hover:bg-gray-100 transition-colors",children:[(0,s.jsx)(u.Z,{className:"h-6 w-6"}),(0,s.jsxs)("div",{className:"flex flex-col items-start",children:[(0,s.jsx)("span",{className:"text-sm font-medium",children:null==b?void 0:b.name}),(0,s.jsx)("span",{className:"text-xs text-gray-500",children:C})]}),(0,s.jsx)(h.Z,{className:"h-4 w-4"})]}),i&&(0,s.jsx)("div",{className:"absolute right-0 mt-1 w-56 bg-white rounded-lg shadow-lg border border-gray-200 z-50",children:(0,s.jsxs)("div",{className:"py-1",children:[(0,s.jsxs)("div",{className:"px-4 py-3 border-b border-gray-100",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900",children:null==b?void 0:b.name}),(0,s.jsx)("p",{className:"text-xs text-gray-500 truncate",children:null==b?void 0:b.email}),(0,s.jsx)("span",{className:"inline-block mt-1 px-2 py-1 text-xs font-medium rounded-full bg-primary-100 text-primary-800",children:C})]}),"admin"===E&&(0,s.jsx)(l(),{href:"/admin-panel",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",onClick:()=>f(!1),children:"Admin Panel"}),("admin"===E||"seller"===E)&&(0,s.jsx)(l(),{href:"/dashboard",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",onClick:()=>f(!1),children:"Dashboard"}),(0,s.jsx)(l(),{href:"/profile",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",onClick:()=>f(!1),children:"Profile"}),(0,s.jsx)(l(),{href:"/orders",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",onClick:()=>f(!1),children:"My Orders"}),"seller"===E&&(0,s.jsx)(l(),{href:"/listings",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",onClick:()=>f(!1),children:"My Listings"}),(0,s.jsx)(l(),{href:"/favorites",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",onClick:()=>f(!1),children:"Favorites"}),(0,s.jsx)("hr",{className:"my-1"}),(0,s.jsx)("button",{onClick:handleLogout,className:"block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50",children:"Logout"})]})})]}):!S&&(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(l(),{href:"/login",className:"text-gray-700 hover:text-gray-900 px-3 py-2 rounded-lg hover:bg-gray-100 transition-colors",children:"Login"}),(0,s.jsx)(l(),{href:"/register",className:"btn-primary px-4 py-2",children:"Sign Up"})]})]}),(0,s.jsx)("button",{onClick:()=>t(!e),className:"md:hidden p-2 text-gray-700 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",children:e?(0,s.jsx)(m.Z,{className:"h-6 w-6"}):(0,s.jsx)(x.Z,{className:"h-6 w-6"})})]}),(0,s.jsx)("div",{className:"md:hidden pb-4",children:(0,s.jsx)("form",{onSubmit:handleSearch,children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:"text",value:r,onChange:e=>o(e.target.value),placeholder:"Search for items...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"}),(0,s.jsx)(d.Z,{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400"})]})})}),e&&(0,s.jsx)("div",{className:"md:hidden border-t border-gray-200 py-4",children:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(l(),{href:"/marketplace",className:"block px-3 py-2 text-gray-700 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",onClick:()=>t(!1),children:"Browse"}),(0,s.jsx)(l(),{href:"/sell",className:"block px-3 py-2 text-gray-700 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",onClick:()=>t(!1),children:"Sell"}),j?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"px-3 py-2 border-b border-gray-200",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900",children:null==b?void 0:b.name}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:null==b?void 0:b.email}),(0,s.jsx)("span",{className:"inline-block mt-1 px-2 py-1 text-xs font-medium rounded-full bg-primary-100 text-primary-800",children:C})]}),"admin"===E&&(0,s.jsx)(l(),{href:"/admin-panel",className:"block px-3 py-2 text-gray-700 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",onClick:()=>t(!1),children:"Admin Panel"}),("admin"===E||"seller"===E)&&(0,s.jsx)(l(),{href:"/dashboard",className:"block px-3 py-2 text-gray-700 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",onClick:()=>t(!1),children:"Dashboard"}),(0,s.jsx)(l(),{href:"/profile",className:"block px-3 py-2 text-gray-700 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",onClick:()=>t(!1),children:"Profile"}),(0,s.jsx)(l(),{href:"/orders",className:"block px-3 py-2 text-gray-700 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",onClick:()=>t(!1),children:"My Orders"}),"seller"===E&&(0,s.jsx)(l(),{href:"/listings",className:"block px-3 py-2 text-gray-700 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",onClick:()=>t(!1),children:"My Listings"}),(0,s.jsxs)(l(),{href:"/cart",className:"block px-3 py-2 text-gray-700 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",onClick:()=>t(!1),children:["Cart (",w,")"]}),(0,s.jsx)(l(),{href:"/favorites",className:"block px-3 py-2 text-gray-700 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",onClick:()=>t(!1),children:"Favorites"}),(0,s.jsx)("button",{onClick:()=>{handleLogout(),t(!1)},className:"block w-full text-left px-3 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:"Logout"})]}):!S&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l(),{href:"/login",className:"block px-3 py-2 text-gray-700 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",onClick:()=>t(!1),children:"Login"}),(0,s.jsx)(l(),{href:"/register",className:"block px-3 py-2 bg-primary-600 text-white hover:bg-primary-700 rounded-lg transition-colors text-center",onClick:()=>t(!1),children:"Sign Up"})]})]})})]})})}},2516:function(e,t,r){r.d(t,{a:function(){return useAuth}});var s=r(2265),a=r(4033),o=r(4829),l=r(5925);let n=o.Z.create({baseURL:"http://localhost/Envisage/backend/public/api",headers:{"Content-Type":"application/json",Accept:"application/json"}});let TokenStorage=class TokenStorage{static setToken(e,t){if(localStorage.setItem(this.TOKEN_KEY,e),t){let e=Date.now()+1e3*t;localStorage.setItem(this.EXPIRES_KEY,e.toString())}}static getToken(){let e=localStorage.getItem(this.TOKEN_KEY),t=localStorage.getItem(this.EXPIRES_KEY);return e&&t&&Date.now()>parseInt(t)?(this.removeToken(),null):e}static removeToken(){localStorage.removeItem(this.TOKEN_KEY),localStorage.removeItem(this.REFRESH_KEY),localStorage.removeItem(this.EXPIRES_KEY)}static isTokenExpired(){let e=localStorage.getItem(this.EXPIRES_KEY);return!!e&&Date.now()>parseInt(e)}};TokenStorage.TOKEN_KEY="envisage_auth_token",TokenStorage.REFRESH_KEY="envisage_refresh_token",TokenStorage.EXPIRES_KEY="envisage_token_expires",n.interceptors.request.use(e=>{let t=TokenStorage.getToken();return t&&(e.headers.Authorization="Bearer ".concat(t)),e}),n.interceptors.response.use(e=>e,e=>{var t;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(TokenStorage.removeToken(),window.location.href="/login"),Promise.reject(e)});let useAuth=()=>{let[e,t]=(0,s.useState)(null),[r,o]=(0,s.useState)(!0),i=(0,a.useRouter)(),c=!!e&&!!TokenStorage.getToken(),d=(0,s.useCallback)(async()=>{try{let e=TokenStorage.getToken();if(!e)return null;let r=await n.get("/user",{headers:{Authorization:"Bearer ".concat(e)}}),s=r.data;return t(s),s}catch(s){var e,r;return console.error("Failed to get user:",s),((null===(e=s.response)||void 0===e?void 0:e.status)===401||(null===(r=s.response)||void 0===r?void 0:r.status)===404)&&(TokenStorage.removeToken(),t(null)),null}},[]);(0,s.useEffect)(()=>{let initializeAuth=async()=>{let e=TokenStorage.getToken();if(e&&!TokenStorage.isTokenExpired())try{await d()}catch(e){console.error("Failed to initialize auth:",e),TokenStorage.removeToken()}o(!1)};initializeAuth()},[d]);let g=(0,s.useCallback)(async e=>{try{o(!0);let r=await n.post("/login",e),{access_token:s,user:a}=r.data;if(s)return TokenStorage.setToken(s),t(a),l.toast.success("Welcome back, ".concat(a.name,"!")),{success:!0,message:"Login successful",user:a};return l.toast.error("Login failed - no token received"),{success:!1,message:"Login failed"}}catch(t){var r,s;console.error("âŒ Login error:",t);let e=(null===(s=t.response)||void 0===s?void 0:null===(r=s.data)||void 0===r?void 0:r.message)||"Login failed. Please check your credentials.";return l.toast.error(e),{success:!1,message:e}}finally{o(!1)}},[]),u=(0,s.useCallback)(async e=>{try{o(!0);let r=await n.post("/register",e),{access_token:s,user:a}=r.data;if(s&&a)return TokenStorage.setToken(s),t(a),l.toast.success("Welcome to Envisage, ".concat(a.name,"!")),{success:!0,message:"Registration successful",user:a};return l.toast.error("Registration failed - no token received"),{success:!1,message:"Registration failed"}}catch(t){var r,s;console.error("Registration error:",t);let e=(null===(s=t.response)||void 0===s?void 0:null===(r=s.data)||void 0===r?void 0:r.message)||"Registration failed. Please try again.";return l.toast.error(e),{success:!1,message:e}}finally{o(!1)}},[]),h=(0,s.useCallback)(async()=>{try{let e=TokenStorage.getToken();await n.post("/logout",{},{headers:{Authorization:"Bearer ".concat(e)}})}catch(e){console.error("Logout request failed:",e)}finally{TokenStorage.removeToken(),t(null),l.toast.success("Logged out successfully"),i.push("/")}},[i]),m=(0,s.useCallback)(async()=>{try{let e=await n.post("/auth/refresh"),{status:r,data:s}=e.data;if("success"===r&&s)return TokenStorage.setToken(s.token,s.expires_in),t(s.user),!0;return!1}catch(e){return console.error("Token refresh failed:",e),TokenStorage.removeToken(),t(null),!1}},[]);return(0,s.useEffect)(()=>{if(!c)return;let e=setInterval(async()=>{let e=TokenStorage.getToken();if(e&&TokenStorage.isTokenExpired()){let e=await m();e||i.push("/login")}},3e5);return()=>clearInterval(e)},[c,m,i]),{user:e,isAuthenticated:c,isLoading:r,login:g,register:u,logout:h,getUser:d,refreshToken:m}}},4962:function(e,t,r){r.d(t,{tN:function(){return o},xS:function(){return l}});var s=r(4660),a=r(4810);let o=(0,s.Ue)()((0,a.tJ)((e,t)=>({user:null,token:null,isAuthenticated:!1,isLoading:!1,login:(t,r)=>{e({user:t,token:r,isAuthenticated:!0,isLoading:!1}),localStorage.setItem("auth_token",r),localStorage.setItem("user_data",JSON.stringify(t))},logout:()=>{e({user:null,token:null,isAuthenticated:!1,isLoading:!1}),localStorage.removeItem("auth_token"),localStorage.removeItem("user_data")},setUser:t=>{e({user:t}),localStorage.setItem("user_data",JSON.stringify(t))},setLoading:t=>{e({isLoading:t})}}),{name:"auth-store",partialize:e=>({user:e.user,token:e.token,isAuthenticated:e.isAuthenticated})})),l=(0,s.Ue)()((0,a.tJ)((e,t)=>({items:[],isOpen:!1,addItem:r=>{let s=t().items.find(e=>e.listing_id===r.listing_id);s?e({items:t().items.map(e=>e.listing_id===r.listing_id?{...e,quantity:e.quantity+1}:e)}):e({items:[...t().items,{...r,quantity:1}]})},removeItem:r=>{e({items:t().items.filter(e=>e.listing_id!==r)})},updateQuantity:(r,s)=>{if(s<=0){t().removeItem(r);return}e({items:t().items.map(e=>e.listing_id===r?{...e,quantity:s}:e)})},clearCart:()=>{e({items:[]})},toggleCart:()=>{e({isOpen:!t().isOpen})},getTotalItems:()=>t().items.reduce((e,t)=>e+t.quantity,0),getTotalPrice:()=>t().items.reduce((e,t)=>e+t.price*t.quantity,0)}),{name:"cart-store"}));(0,s.Ue)()((0,a.tJ)((e,t)=>({sidebarOpen:!1,theme:"light",searchQuery:"",filters:{category:"",condition:"",minPrice:null,maxPrice:null,location:"",sortBy:"newest"},setSidebarOpen:t=>{e({sidebarOpen:t})},setTheme:t=>{e({theme:t})},setSearchQuery:t=>{e({searchQuery:t})},setFilters:r=>{e({filters:{...t().filters,...r}})},resetFilters:()=>{e({filters:{category:"",condition:"",minPrice:null,maxPrice:null,location:"",sortBy:"newest"}})}}),{name:"ui-store",partialize:e=>({theme:e.theme,filters:e.filters})}))}}]);