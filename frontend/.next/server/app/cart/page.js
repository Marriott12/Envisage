(()=>{var e={};e.id=1565,e.ids=[1565],e.modules={5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},1877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},5319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},9491:e=>{"use strict";e.exports=require("assert")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},7147:e=>{"use strict";e.exports=require("fs")},3685:e=>{"use strict";e.exports=require("http")},5158:e=>{"use strict";e.exports=require("http2")},5687:e=>{"use strict";e.exports=require("https")},2037:e=>{"use strict";e.exports=require("os")},1017:e=>{"use strict";e.exports=require("path")},2781:e=>{"use strict";e.exports=require("stream")},6224:e=>{"use strict";e.exports=require("tty")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},9796:e=>{"use strict";e.exports=require("zlib")},3603:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>x,originalPathname:()=>p,pages:()=>d,routeModule:()=>u,tree:()=>l});var s=r(7096),a=r(6132),n=r(7284),i=r.n(n),c=r(2564),o={};for(let e in c)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>c[e]);r.d(t,o);let l=["",{children:["cart",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,6893)),"c:\\wamp64\\www\\Envisage\\frontend\\app\\cart\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,5345)),"c:\\wamp64\\www\\Envisage\\frontend\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,9291,23)),"next/dist/client/components/not-found-error"]}],d=["c:\\wamp64\\www\\Envisage\\frontend\\app\\cart\\page.tsx"],p="/cart/page",x={require:r,loadChunk:()=>Promise.resolve()},u=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/cart/page",pathname:"/cart",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},1061:(e,t,r)=>{Promise.resolve().then(r.bind(r,7647))},7647:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>CartPage});var s=r(784),a=r(9885),n=r(3653),i=r(345),c=r(8551),o=r(7152),l=r(8282);function LoadingSpinner({size:e="md",text:t,fullScreen:r=!1}){let a=(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:`animate-spin rounded-full border-b-2 border-primary-600 mx-auto ${{sm:"h-6 w-6",md:"h-12 w-12",lg:"h-16 w-16"}[e]}`}),t&&(0,s.jsx)("p",{className:"mt-4 text-gray-600",children:t})]});return r?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:a}):a}var d=r(4635),p=r(1440),x=r.n(p);let u="http://localhost/Envisage/backend/public/api";let TokenStorage=class TokenStorage{static{this.TOKEN_KEY="envisage_auth_token"}static getToken(){return localStorage.getItem(this.TOKEN_KEY)}};function CartContent(){let{user:e,isAuthenticated:t}=(0,n.a)(),[r,o]=(0,a.useState)(null),[p,m]=(0,a.useState)(!0),[h,g]=(0,a.useState)(null),fetchCart=async()=>{if(!t||!e){m(!1);return}try{m(!0),g(null);let e=TokenStorage.getToken();if(!e){g("Not authenticated. Please log in again."),m(!1);return}let t=await c.Z.get(`${u}/cart`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json",Accept:"application/json"}});console.log("Cart response:",t.data),o(t.data)}catch(t){console.error("Cart error:",t);let e=t.response?.data?.message||t.message||"Failed to load cart";g(e),i.toast.error(e)}finally{m(!1)}};(0,a.useEffect)(()=>{fetchCart()},[t,e]);let handleRemoveItem=async e=>{try{let t=TokenStorage.getToken();await c.Z.delete(`${u}/cart/${e}`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}}),i.toast.success("Item removed from cart"),fetchCart()}catch(e){console.error("Remove item error:",e),i.toast.error("Failed to remove item")}},handleUpdateQuantity=async(e,t)=>{if(!(t<1))try{let r=TokenStorage.getToken();await c.Z.put(`${u}/cart/${e}`,{quantity:t},{headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"}}),fetchCart()}catch(e){console.error("Update quantity error:",e),i.toast.error(e.response?.data?.error||"Failed to update quantity")}};return p?(0,s.jsx)(LoadingSpinner,{size:"lg",text:"Loading your cart...",fullScreen:!0}):h?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.Z,{}),(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md",children:[(0,s.jsx)("p",{className:"text-red-600 mb-4",children:h}),(0,s.jsx)("button",{onClick:fetchCart,className:"btn-primary",children:"Try Again"})]})})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.Z,{}),(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-8",children:"Shopping Cart"}),r&&r.items&&0!==r.items.length?(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,s.jsx)("div",{className:"lg:col-span-2 space-y-4",children:r.items.map(e=>(0,s.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:(0,s.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,s.jsx)("div",{className:"w-24 h-24 bg-gray-100 rounded-lg flex-shrink-0 overflow-hidden",children:(e.product.image||e.product.images?.[0])&&(0,s.jsx)("img",{src:e.product.image||e.product.images?.[0],alt:e.product.title,className:"w-full h-full object-cover"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:e.product.title}),(0,s.jsxs)("p",{className:"text-xl font-bold text-primary-600 mb-3",children:["ZMW ",e.product.price.toFixed(2)]}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsxs)("div",{className:"flex items-center border border-gray-300 rounded-lg",children:[(0,s.jsx)("button",{onClick:()=>handleUpdateQuantity(e.id,e.quantity-1),className:"px-3 py-1 hover:bg-gray-100",disabled:e.quantity<=1,children:"-"}),(0,s.jsx)("span",{className:"px-4 py-1 border-x border-gray-300",children:e.quantity}),(0,s.jsx)("button",{onClick:()=>handleUpdateQuantity(e.id,e.quantity+1),className:"px-3 py-1 hover:bg-gray-100",disabled:e.quantity>=e.product.stock,children:"+"})]}),(0,s.jsxs)("button",{onClick:()=>handleRemoveItem(e.id),className:"text-red-600 hover:text-red-800 flex items-center space-x-1",children:[(0,s.jsx)(d.Z,{className:"h-5 w-5"}),(0,s.jsx)("span",{children:"Remove"})]})]}),e.product.stock<5&&(0,s.jsxs)("p",{className:"text-sm text-orange-600 mt-2",children:["Only ",e.product.stock," left in stock"]})]}),(0,s.jsx)("div",{className:"text-right",children:(0,s.jsxs)("p",{className:"text-lg font-semibold text-gray-900",children:["ZMW ",(e.product.price*e.quantity).toFixed(2)]})})]})},e.id))}),(0,s.jsx)("div",{className:"lg:col-span-1",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6 sticky top-8",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Order Summary"}),(0,s.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,s.jsxs)("div",{className:"flex justify-between text-gray-600",children:[(0,s.jsxs)("span",{children:["Subtotal (",r.item_count," items)"]}),(0,s.jsxs)("span",{children:["ZMW ",r.total.toFixed(2)]})]}),(0,s.jsxs)("div",{className:"flex justify-between text-gray-600",children:[(0,s.jsx)("span",{children:"Shipping"}),(0,s.jsx)("span",{children:"Calculated at checkout"})]}),(0,s.jsx)("div",{className:"border-t border-gray-200 pt-3",children:(0,s.jsxs)("div",{className:"flex justify-between text-lg font-semibold text-gray-900",children:[(0,s.jsx)("span",{children:"Total"}),(0,s.jsxs)("span",{children:["ZMW ",r.total.toFixed(2)]})]})})]}),(0,s.jsx)(x(),{href:"/checkout",className:"btn-primary w-full block text-center mb-3",children:"Proceed to Checkout"}),(0,s.jsx)(x(),{href:"/marketplace",className:"btn-secondary w-full block text-center",children:"Continue Shopping"})]})})]}):(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-12 text-center",children:[(0,s.jsx)("p",{className:"text-gray-500 mb-4",children:"Your cart is empty"}),(0,s.jsx)(x(),{href:"/marketplace",className:"btn-primary inline-block",children:"Continue Shopping"})]})]})})]})}function CartPage(){return(0,s.jsx)(o.Z,{children:(0,s.jsx)(CartContent,{})})}},6893:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>i,__esModule:()=>n,default:()=>o});var s=r(5153);let a=(0,s.createProxy)(String.raw`c:\wamp64\www\Envisage\frontend\app\cart\page.tsx`),{__esModule:n,$$typeof:i}=a,c=a.default,o=c}};var t=require("../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[2527,7721,7941,4635,7089,3653,8282,7152],()=>__webpack_exec__(3603));module.exports=r})();